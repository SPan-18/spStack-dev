<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Bayesian spatially-temporally varying coefficients generalized linear model using predictive stacking — stvcGLMstack • spStack</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian spatially-temporally varying coefficients generalized linear model using predictive stacking — stvcGLMstack"><meta name="description" content="Fits Bayesian spatial-temporal generalized linear model with
spatially-temporally varying coefficients on a collection of candidate models
constructed based on some candidate values of some model parameters specified
by the user and subsequently combines inference by stacking predictive
densities. See Pan, Zhang, Bradley, and Banerjee (2024) for more details."><meta property="og:description" content="Fits Bayesian spatial-temporal generalized linear model with
spatially-temporally varying coefficients on a collection of candidate models
constructed based on some candidate values of some model parameters specified
by the user and subsequently combines inference by stacking predictive
densities. See Pan, Zhang, Bradley, and Banerjee (2024) for more details."><meta property="og:image" content="https://span-18.github.io/spStack-dev/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spStack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/spStack.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/posterior-predictive.html">Posterior Predictive Inference</a></li>
    <li><a class="dropdown-item" href="../articles/spatial-temporal.html">Spatial-Temporal Regression Models</a></li>
    <li><a class="dropdown-item" href="../articles/spatial.html">Spatial Regression Models</a></li>
    <li><a class="dropdown-item" href="../articles/technical_overview.html">Technical Overview</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SPan-18/spStack-dev/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Bayesian spatially-temporally varying coefficients generalized linear model using predictive stacking</h1>
      <small class="dont-index">Source: <a href="https://github.com/SPan-18/spStack-dev/blob/master/R/stvcGLMstack.R" class="external-link"><code>R/stvcGLMstack.R</code></a></small>
      <div class="d-none name"><code>stvcGLMstack.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits Bayesian spatial-temporal generalized linear model with
spatially-temporally varying coefficients on a collection of candidate models
constructed based on some candidate values of some model parameters specified
by the user and subsequently combines inference by stacking predictive
densities. See Pan, Zhang, Bradley, and Banerjee (2024) for more details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stvcGLMstack</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">family</span>,</span>
<span>  <span class="va">sp_coords</span>,</span>
<span>  <span class="va">time_coords</span>,</span>
<span>  <span class="va">cor.fn</span>,</span>
<span>  <span class="va">process.type</span>,</span>
<span>  <span class="va">priors</span>,</span>
<span>  <span class="va">candidate.models</span>,</span>
<span>  <span class="va">n.samples</span>,</span>
<span>  <span class="va">loopd.controls</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  solver <span class="op">=</span> <span class="st">"ECOS"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a symbolic description of the regression model to be fit.
Variables in parenthesis are assigned spatially-temporally varying
coefficients. See examples.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an optional data frame containing the variables in the model.
If not found in <code>data</code>, the variables are taken from
<code>environment(formula)</code>, typically the environment from which
<code>stvcGLMstack</code> is called.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>Specifies the distribution of the response as a member of the
exponential family. Supported options are <code>'poisson'</code>, <code>'binomial'</code> and
<code>'binary'</code>.</p></dd>


<dt id="arg-sp-coords">sp_coords<a class="anchor" aria-label="anchor" href="#arg-sp-coords"></a></dt>
<dd><p>an \(n \times 2\) matrix of the observation
spatial coordinates in \(\mathbb{R}^2\) (e.g., easting and northing).</p></dd>


<dt id="arg-time-coords">time_coords<a class="anchor" aria-label="anchor" href="#arg-time-coords"></a></dt>
<dd><p>an \(n \times 1\) matrix of the observation
temporal coordinates in \(\mathcal{T} \subseteq [0, \infty)\).</p></dd>


<dt id="arg-cor-fn">cor.fn<a class="anchor" aria-label="anchor" href="#arg-cor-fn"></a></dt>
<dd><p>a quoted keyword that specifies the correlation function used
to model the spatial-temporal dependence structure among the observations.
Supported covariance model key words are: <code>'gneiting-decay'</code> (Gneiting
and Guttorp 2010). See below for details.</p></dd>


<dt id="arg-process-type">process.type<a class="anchor" aria-label="anchor" href="#arg-process-type"></a></dt>
<dd><p>a quoted keyword specifying the model for the
spatial-temporal process. Supported keywords are <code>'independent'</code> which
indicates independent processes for each varying coefficients characterized
by different process parameters, <code>independent.shared</code> implies independent
processes for the varying coefficients that shares common process parameters,
and <code>multivariate</code> implies correlated processes for the varying coefficients
modeled by a multivariate Gaussian process with an inverse-Wishart prior on
the correlation matrix. The input for <code>sptParams</code> and <code>priors</code> must be given
accordingly.</p></dd>


<dt id="arg-priors">priors<a class="anchor" aria-label="anchor" href="#arg-priors"></a></dt>
<dd><p>(optional) a list with each tag corresponding to a
hyperparameter name and containing hyperprior details. Valid tags include
<code>V.beta</code>, <code>nu.beta</code>, <code>nu.z</code>, <code>sigmaSq.xi</code> and <code>IW.scale</code>. Values of <code>nu.beta</code>
and <code>nu.z</code> must be at least 2.1. If not supplied, uses defaults.</p></dd>


<dt id="arg-candidate-models">candidate.models<a class="anchor" aria-label="anchor" href="#arg-candidate-models"></a></dt>
<dd><p>an object of class <code>candidateModels</code> containing a
list of candidate models for stacking. See <code><a href="candidateModels.html">candidateModels()</a></code> for details.</p></dd>


<dt id="arg-n-samples">n.samples<a class="anchor" aria-label="anchor" href="#arg-n-samples"></a></dt>
<dd><p>number of samples to be drawn from the posterior
distribution.</p></dd>


<dt id="arg-loopd-controls">loopd.controls<a class="anchor" aria-label="anchor" href="#arg-loopd-controls"></a></dt>
<dd><p>a list with details on how leave-one-out predictive
densities (LOO-PD) are to be calculated. Valid tags include <code>method</code>, <code>CV.K</code>
and <code>nMC</code>. The tag <code>method</code> can be either <code>'exact'</code> or <code>'CV'</code>. If sample size
is more than 100, then the default is <code>'CV'</code> with <code>CV.K</code> equal to its default
value 10 (Gelman <em>et al.</em> 2024). The tag <code>nMC</code> decides how many Monte Carlo
samples will be used to evaluate the leave-one-out predictive densities,
which must be at least 500 (default).</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>logical. If <code>parallel=FALSE</code>, the parallelization plan,
if set up by the user, is ignored. If <code>parallel=TRUE</code>, the function
inherits the parallelization plan that is set by the user via the function
<code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> only. Depending on the parallel backend available, users
may choose their own plan. More details are available at
<a href="https://cran.R-project.org/package=future" class="external-link">https://cran.R-project.org/package=future</a>.</p></dd>


<dt id="arg-solver">solver<a class="anchor" aria-label="anchor" href="#arg-solver"></a></dt>
<dd><p>(optional) Specifies the name of the solver that will be used
to obtain optimal stacking weights for each candidate model. Default is
<code>'ECOS'</code>. Users can use other solvers supported by the
<a href="https://www.cvxgrp.org/CVXR/reference/CVXR-package.html" class="external-link">CVXR-package</a> package.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical. If <code>TRUE</code>, prints model-specific optimal
stacking weights.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>currently no additional argument.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>stvcGLMstack</code>, which is a list including the
following tags -</p><dl><dt><code>samples</code></dt>
<dd><p>a list of length equal to total number of candidate models
with each entry corresponding to a list of length 3, containing posterior
samples of fixed effects (<code>beta</code>), spatial effects (<code>z</code>), and
fine scale variation <code>xi</code> for that model.</p></dd>

<dt><code>loopd</code></dt>
<dd><p>a list of length equal to total number of candidate models with
each entry containing leave-one-out predictive densities under that
particular model.</p></dd>

<dt><code>n.models</code></dt>
<dd><p>number of candidate models that are fit.</p></dd>

<dt><code>candidate.models</code></dt>
<dd><p>a list of length <code>n_model</code> rows with each
entry containing details of the model parameters.</p></dd>

<dt><code>stacking.weights</code></dt>
<dd><p>a numeric vector of length equal to the number of
candidate models storing the optimal stacking weights.</p></dd>

<dt><code>run.time</code></dt>
<dd><p>a <code>proc_time</code> object with runtime details.</p></dd>

<dt><code>solver.status</code></dt>
<dd><p>solver status as returned by the optimization
routine.</p></dd>


</dl><p>This object can be further used to recover posterior samples of the scale
parameters in the model, and subsequrently, to make predictions at new
locations or times using the function <code><a href="posteriorPredict.html">posteriorPredict()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sim_stvcPoisson"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">sim_stvcPoisson</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create list of candidate models (multivariate)</span></span></span>
<span class="r-in"><span><span class="va">mod.list2</span> <span class="op">&lt;-</span> <span class="fu"><a href="candidateModels.html">candidateModels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>phi_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  phi_t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  boundary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>, <span class="st">"cartesian"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a spatial-temporal varying coefficient model using predictive stacking</span></span></span>
<span class="r-in"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">stvcGLMstack</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="op">(</span><span class="va">x1</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="st">"poisson"</span>,</span></span>
<span class="r-in"><span>                     sp_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     time_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="st">"t_coords"</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     cor.fn <span class="op">=</span> <span class="st">"gneiting-decay"</span>,</span></span>
<span class="r-in"><span>                     process.type <span class="op">=</span> <span class="st">"multivariate"</span>,</span></span>
<span class="r-in"><span>                     candidate.models <span class="op">=</span> <span class="va">mod.list2</span>,</span></span>
<span class="r-in"><span>                     loopd.controls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"CV"</span>, CV.K <span class="op">=</span> <span class="fl">10</span>, nMC <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     n.samples <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> STACKING WEIGHTS:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            | phi_s | phi_t | boundary | weight |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +----------+-------+-------+----------+--------+</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 1  |      1|      1|      0.50| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 2  |      2|      1|      0.50| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 3  |      3|      1|      0.50| 0.181  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 4  |      1|      2|      0.50| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 5  |      2|      2|      0.50| 0.026  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 6  |      3|      2|      0.50| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 7  |      1|      4|      0.50| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 8  |      2|      4|      0.50| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 9  |      3|      4|      0.50| 0.793  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 10 |      1|      1|      0.75| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 11 |      2|      1|      0.75| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 12 |      3|      1|      0.75| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 13 |      1|      2|      0.75| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 14 |      2|      2|      0.75| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 15 |      3|      2|      0.75| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 16 |      1|      4|      0.75| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 17 |      2|      4|      0.75| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | Model 18 |      3|      4|      0.75| 0.000  |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +----------+-------+-------+----------+--------+</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Soumyakanti Pan, Sudipto Banerjee.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

