<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>spStack: Bayesian Geostatistics Using Predictive Stacking ‚Ä¢ spStack</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="spStack: Bayesian Geostatistics Using Predictive Stacking">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spStack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/spStack.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SPan-18/spStack-dev/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>spStack: Bayesian Geostatistics Using Predictive Stacking</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SPan-18/spStack-dev/blob/master/vignettes/spStack.Rmd" class="external-link"><code>vignettes/spStack.Rmd</code></a></small>
      <div class="d-none name"><code>spStack.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Geostatistics refers to the study of a spatially distributed variable
of interest, which in theory is defined at every point over a bounded
study region of interest. Statistical modelling and analysis for
spatially oriented point-referenced outcomes play a crucial role in
diverse scientific applications such as earth and environmental
sciences, ecology, epidemiology, and economics. With the advent of
Markov chain Monte Carlo (MCMC) algorithms, Bayesian hierarchical models
have gained massive popularity in analyzing such point-referenced or,
geostatistical data. These models involve latent spatial processes
characterized by spatial process parameters, which besides lacking
substantive relevance in scientific contexts, are also weakly identified
and hence, impedes convergence of MCMC algorithms. Thus, even for
moderately large datasets
(~<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mn>3</mn></msup><annotation encoding="application/x-tex">10^3</annotation></semantics></math>
or higher), the computation for MCMC becomes too onerous for practical
use.</p>
<p>We introduce the R package <code>spStack</code> that implements
Bayesian inference for a class of geostatistical models, where we
obviate the issues mentioned by sampling from analytically available
posterior distributions conditional upon some candidate values of the
spatial process parameters and, subsequently assimilate inference from
these individual posterior distributions using Bayesian predictive
stacking. Besides delivering competitive predictive performance as
compared to fully Bayesian inference using MCMC, our proposed algorithm
is embarrassingly parallel, thus drastically improves runtime and
elevating the utility of the package for a diverse group of
practitioners with limited computational resources at their disposal.
This package, to the best of our knowledge, is the first to implement
stacking for Bayesian analysis of spatial data.</p>
<p>Technical details surrounding the methodology can be found in the
articles <span class="citation">Zhang, Tang, and Banerjee (<a href="#ref-zhang2024stacking">2024</a>)</span> which discuss the case
where the distribution of the point-referenced outcomes are Gaussian,
and, in <span class="citation">Pan et al. (<a href="#ref-pan2024stacking">2024</a>)</span> where the case of
non-Gaussian outcomes is explored. The code for this package is written
primarily in C/C++ with additional calls to FORTRAN routines for
optimized linear algebra operations. We leverage the
<code>F77_NAME</code> macro to interface with legacy FORTRAN functions
in conjunction with efficient matrix computation libraries such as <a href="https://netlib.org/blas/" class="external-link">BLAS</a> (Basic Linear Algebra
Subprograms) and <a href="https://netlib.org/lapack/" class="external-link">LAPACK</a> (Linear
Algebra Package) to implement our stacking algorithm.</p>
<p>The remainder of the vignette evolves as follows - the next two
sections discuss Bayesian hierarchical spatial models for Gaussian and
non-Gaussian outcomes, which is followed by a section providing brief
details on predictive stacking and a section dedicated for illustration
of functions in the package.</p>
</div>
<div class="section level2">
<h2 id="bayesian-gaussian-spatial-regression-models">Bayesian Gaussian spatial regression models<a class="anchor" aria-label="anchor" href="#bayesian-gaussian-spatial-regression-models"></a>
</h2>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œá</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>s</mi><mn>1</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>s</mi><mi>n</mi></msub><mo stretchy="false" form="postfix">}</mo><mo>‚àà</mo><mi>ùíü</mi></mrow><annotation encoding="application/x-tex">\chi = \{s_1, \ldots, s_n\} \in \mathcal{D}</annotation></semantics></math>
be a be a set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
spatial locations yielding measurements
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup></mrow><annotation encoding="application/x-tex">y = (y_1, \ldots, y_n)^{ \scriptstyle \top }</annotation></semantics></math>
with known values of predictors at these locations collected in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>√ó</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">n \times p</annotation></semantics></math>
full rank matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">[</mo><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>‚ä§</mi></msup></mrow><annotation encoding="application/x-tex">X = [x(s_1), \ldots, x(s_n)]^{ \scriptstyle \top }</annotation></semantics></math>.
A customary geostatistical model is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mi>x</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup><mi>Œ≤</mi><mo>+</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>œµ</mi><mi>i</mi></msub><mo>,</mo><mspace width="1.0em"></mspace><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>n</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
  y_i = x(s_i)^{ \scriptstyle \top }\beta + z(s_i) + \epsilon_i, \quad i = 1, \ldots, n,
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>√ó</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p \times 1</annotation></semantics></math>
vector of slopes,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àº</mo><mrow><mi mathvariant="normal">G</mi><mi mathvariant="normal">P</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo>,</mo><mo>‚ãÖ</mo><mo>;</mo><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z(s) \sim \mathrm{GP}(0, R(\cdot, \cdot; {\theta_{\text{sp}}}))</annotation></semantics></math>
is a zero-centered spatial Gaussian process on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùíü</mi><annotation encoding="application/x-tex">\mathcal{D}</annotation></semantics></math>
with spatial correlation function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo>,</mo><mo>‚ãÖ</mo><mo>;</mo><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">R(\cdot, \cdot; {\theta_{\text{sp}}})</annotation></semantics></math>
characterized by process parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><annotation encoding="application/x-tex">{\theta_{\text{sp}}}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>œÉ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>
is the spatial variance parameter (‚Äúpartial sill‚Äù) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œµ</mi><mi>i</mi></msub><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>œÑ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\epsilon_i \sim \mathcal{N}(0, \tau^2), i = 1, \ldots, n</annotation></semantics></math>
are i.i.d. with variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>œÑ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\tau^2</annotation></semantics></math>
(‚Äúnugget‚Äù) capturing measurement error. The spatial process
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z(\cdot)</annotation></semantics></math>
is assumed to be independent of the measurement errors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>œµ</mi><mi>i</mi></msub><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>n</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\epsilon_i, i = 1, \ldots, n\}</annotation></semantics></math>.
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup></mrow><annotation encoding="application/x-tex">z = (z(s_1), \ldots, z(s_n))^{ \scriptstyle \top }</annotation></semantics></math>
denotes the realization of the spatial process on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œá</mi><annotation encoding="application/x-tex">\chi</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>√ó</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math>
correlation matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>œá</mi><mo>;</mo><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo>,</mo><msub><mi>s</mi><mi>j</mi></msub><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mn>1</mn><mo>‚â§</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo>‚â§</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">R(\chi; {\theta_{\text{sp}}}) = (R(s_i, s_j {\theta_{\text{sp}}}))_{1 \leq i,j \leq n}</annotation></semantics></math>.
We build a conjugate Bayesian hierarchical spatial model,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi><mo>‚à£</mo><mi>z</mi><mo>,</mo><mi>Œ≤</mi><mo>,</mo><msup><mi>œÉ</mi><mn>2</mn></msup></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mi>Œ≤</mi><mo>+</mo><mi>z</mi><mo>,</mo><msup><mi>Œ¥</mi><mn>2</mn></msup><msup><mi>œÉ</mi><mn>2</mn></msup><msub><mi>I</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>z</mi><mo>‚à£</mo><msup><mi>œÉ</mi><mn>2</mn></msup></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>œá</mi><mo>;</mo><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Œ≤</mi><mo>‚à£</mo><msup><mi>œÉ</mi><mn>2</mn></msup></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>Œ≤</mi></msub><mo>,</mo><msup><mi>œÉ</mi><mn>2</mn></msup><msub><mi>V</mi><mi>Œ≤</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msup><mi>œÉ</mi><mn>2</mn></msup><mo>‚àº</mo><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">G</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>œÉ</mi></msub><mo>,</mo><msub><mi>b</mi><mi>œÉ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{split}
y \mid z, \beta, \sigma^2 &amp;\sim N(X\beta + z, \delta^2 \sigma^2 I_n), \\
z \mid \sigma^2 &amp;\sim N(0, \sigma^2 R(\chi; {\theta_{\text{sp}}})), \\
\beta \mid \sigma^2 &amp;\sim N(\mu_\beta, \sigma^2 V_\beta), \quad
\sigma^2 \sim \mathrm{IG}(a_\sigma, b_\sigma),
\end{split}
\end{equation}</annotation></semantics></math> where we fix the
noise-to-spatial variance ratio
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Œ¥</mi><mn>2</mn></msup><mo>=</mo><msup><mi>œÑ</mi><mn>2</mn></msup><mi>/</mi><msup><mi>œÉ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\delta^2 = \tau^2 / \sigma^2</annotation></semantics></math>,
the process parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><annotation encoding="application/x-tex">{\theta_{\text{sp}}}</annotation></semantics></math>
and the hyperparameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>Œ≤</mi></msub><annotation encoding="application/x-tex">\mu_\beta</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>Œ≤</mi></msub><annotation encoding="application/x-tex">V_\beta</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>œÉ</mi></msub><annotation encoding="application/x-tex">a_\sigma</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>œÉ</mi></msub><annotation encoding="application/x-tex">b_\sigma</annotation></semantics></math>.
In this package, we use the Matern covariogram specified by spatial
decay parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œï</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
and smoothness parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ŒΩ</mi><annotation encoding="application/x-tex">\nu</annotation></semantics></math>
i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo>=</mo><mo stretchy="false" form="prefix">{</mo><mi>œï</mi><mo>,</mo><mi>ŒΩ</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">{\theta_{\text{sp}}}= \{\phi, \nu\}</annotation></semantics></math>,
given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>s</mi><mi>‚Ä≤</mi><mo>;</mo><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>œï</mi><mo stretchy="false" form="prefix">|</mo><mi>s</mi><mo>‚àí</mo><mi>s</mi><mi>‚Ä≤</mi><mo stretchy="false" form="postfix">|</mo><mo stretchy="true" form="postfix">)</mo></mrow><mi>ŒΩ</mi></msup><mrow><msup><mn>2</mn><mrow><mi>ŒΩ</mi><mo>‚àí</mo><mn>1</mn></mrow></msup><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ŒΩ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><msub><mi>K</mi><mi>ŒΩ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>œï</mi><mo stretchy="false" form="prefix">|</mo><mi>s</mi><mo>‚àí</mo><mi>s</mi><mi>‚Ä≤</mi><mo stretchy="false" form="postfix">|</mo><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">)</mo><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
R(s, s'; {\theta_{\text{sp}}}) = \frac{(\phi \lvert s - s' \rvert)^\nu}{2^{\nu - 1} \Gamma(\nu)} K_\nu (\phi \lvert s - s' \rvert)).
\end{equation}</annotation></semantics></math> We utilize a composition
sampling strategy to sample the model parameters from their joint
posterior distribution which can be written as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mo>,</mo><mi>Œ≤</mi><mo>,</mo><mi>z</mi><mo>‚à£</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mo>‚à£</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>√ó</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ≤</mi><mo>‚à£</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>√ó</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>‚à£</mo><mi>Œ≤</mi><mo>,</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
p(\sigma^2, \beta, z \mid y) = p(\sigma^2 \mid y) \times
p(\beta \mid \sigma^2, y) \times p(z \mid \beta, \sigma^2, y).
\end{equation}</annotation></semantics></math> We proceed by first
sampling
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>œÉ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>
from its marginal posterior, then given the samples of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>œÉ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>,
we sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
and subsequently, we sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
conditioned on the posterior samples of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>œÉ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math><span class="citation">(<a href="#ref-banerjee_massivespatial">Banerjee
2020</a>)</span>. The function <code><a href="../reference/spLMexact.html">spLMexact()</a></code> delivers samples
from this posterior distribution. More details can be found in <span class="citation">Zhang, Tang, and Banerjee (<a href="#ref-zhang2024stacking">2024</a>)</span>.</p>
</div>
<div class="section level2">
<h2 id="bayesian-non-gaussian-spatial-regression-models">Bayesian non-Gaussian spatial regression models<a class="anchor" aria-label="anchor" href="#bayesian-non-gaussian-spatial-regression-models"></a>
</h2>
<p>Analyzing non-Gaussian spatial data typically requires introducing
spatial dependence in generalized linear models through the link
function of an exponential family distribution. Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y(s)</annotation></semantics></math>
be the outcome at location
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>‚àà</mo><mi>ùíü</mi></mrow><annotation encoding="application/x-tex">s \in \mathcal{D}</annotation></semantics></math>
endowed with a probability law from the natural exponential family,
which we denote by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àº</mo><mrow><mi mathvariant="normal">E</mi><mi mathvariant="normal">F</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup><mi>Œ≤</mi><mo>+</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>;</mo><mi>b</mi><mo>,</mo><msub><mi>œà</mi><mi>y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
    y(s) \sim \mathrm{EF}(x(s)^{ \scriptstyle \top }\beta  + z(s); b, \psi_y)
\end{equation}</annotation></semantics></math> for some positive
parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">b &gt; 0</annotation></semantics></math>
and unit log partition function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œà</mi><mi>y</mi></msub><annotation encoding="application/x-tex">\psi_y</annotation></semantics></math>.
Fixed effects regression and spatial dependence, e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup><mi>Œ≤</mi><mo>+</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">x(s)^{{ \scriptstyle \top }}\beta + z(s)</annotation></semantics></math>,
is introduced in the natural parameter, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">x(s)</annotation></semantics></math>
is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>√ó</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p \times 1</annotation></semantics></math>
vector of predictors referenced with respect to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>√ó</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p \times 1</annotation></semantics></math>
vector of slopes measuring the trend,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z(s)</annotation></semantics></math>
is a zero-centered spatial process on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùíü</mi><annotation encoding="application/x-tex">\mathcal{D}</annotation></semantics></math>
specified by a scale parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÉ</mi><mi>z</mi></msub><annotation encoding="application/x-tex">\sigma_z</annotation></semantics></math>
and a spatial correlation function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo>,</mo><mo>‚ãÖ</mo><mo>;</mo><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">R(\cdot, \cdot ; {\theta_{\text{sp}}})</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><annotation encoding="application/x-tex">{\theta_{\text{sp}}}</annotation></semantics></math>
consisting of spatial-temporal decay and smoothness parameters.</p>
<p>Unlike in Gaussian likelihoods, inference is considerably encumbered
by the inability to analytically integrate out the random effects and
reduce the dimension of the parameter space. Iterative algorithms such
as Markov Chain Monte Carlo (MCMC), thus attempt to sample from a very
high-dimensional posterior distribution, and convergence is often
hampered by high auto-correlations and weakly identified spatial process
parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><annotation encoding="application/x-tex">{\theta_{\text{sp}}}</annotation></semantics></math>.</p>
<p>We consider the following three cases -</p>
<ol style="list-style-type: decimal">
<li>Point-referenced Poisson count data: Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">b = 1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œà</mi><mi>y</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>e</mi><mi>t</mi></msup></mrow><annotation encoding="application/x-tex">\psi_y(t) = e^t</annotation></semantics></math>.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mrow><mi mathvariant="normal">P</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>n</mi><mi>.</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Œª</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup><mi>Œ≤</mi><mo>+</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{split}
y(s_i) &amp;\sim \mathrm{Poisson}(\lambda(s_i)), \quad i = 1, \dots, n.\\
\lambda(s_i) &amp; = \exp(x(s_i)^{ \scriptstyle \top }\beta + z(s_i))
\end{split}
\end{equation}</annotation></semantics></math>
</li>
<li>Point-referenced binomial count data: Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mi>m</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">b = m(s_i)</annotation></semantics></math>
for each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œà</mi><mi>y</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mi>t</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\psi_y(t) = \log(1 + e^t)</annotation></semantics></math>.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mrow><mi mathvariant="normal">B</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>œÄ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>n</mi><mi>.</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>œÄ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup><mi>Œ≤</mi><mo>+</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{split}
y(s_i) &amp;\sim \mathrm{Binomial}(m(s_i), \pi(s_i)), \quad i = 1, \dots, n.\\
\pi(s_i) &amp; = \mathrm{ilogit}(x(s_i)^{ \scriptstyle \top }\beta + z(s_i))
\end{split}
\end{equation}</annotation></semantics></math>
</li>
<li>Point-referenced binary data: Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">b = 1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œà</mi><mi>y</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mi>t</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\psi_y(t) = \log(1 + e^t)</annotation></semantics></math>.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mrow><mi mathvariant="normal">B</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>œÄ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>n</mi><mi>.</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>œÄ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup><mi>Œ≤</mi><mo>+</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{split}
y(s_i) &amp;\sim \mathrm{Bernoulli}(\pi(s_i)), \quad i = 1, \dots, n.\\
\pi(s_i) &amp; = \mathrm{ilogit}(x(s_i)^{ \scriptstyle \top }\beta + z(s_i))
\end{split}
\end{equation}</annotation></semantics></math>
</li>
</ol>
<p>Following <span class="citation">Bradley and Clinch (<a href="#ref-bradleyclinch2024">2024</a>)</span>, we introduce a Bayesian
hierarchical spatial model as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚à£</mo><mi>Œ≤</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>Œæ</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mrow><mi mathvariant="normal">E</mi><mi mathvariant="normal">F</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup><mi>Œ≤</mi><mo>+</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>Œæ</mi><mi>i</mi></msub><mo>‚àí</mo><msub><mi>Œº</mi><mi>i</mi></msub><mo>;</mo><msub><mi>b</mi><mi>i</mi></msub><mo>,</mo><msub><mi>œà</mi><mi>y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>n</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Œ≤</mi><mo>‚à£</mo><msubsup><mi>œÉ</mi><mi>Œ≤</mi><mn>2</mn></msubsup></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>œÉ</mi><mi>Œ≤</mi><mn>2</mn></msubsup><msub><mi>V</mi><mi>Œ≤</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msubsup><mi>œÉ</mi><mi>Œ≤</mi><mn>2</mn></msubsup><mo>‚àº</mo><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">G</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ŒΩ</mi><mi>Œ≤</mi></msub><mi>/</mi><mn>2</mn><mo>,</mo><msub><mi>ŒΩ</mi><mi>Œ≤</mi></msub><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>z</mi><mo>‚à£</mo><msubsup><mi>œÉ</mi><mi>z</mi><mn>2</mn></msubsup></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>œÉ</mi><mi>z</mi><mn>2</mn></msubsup><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>œá</mi><mo>;</mo><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msubsup><mi>œÉ</mi><mi>z</mi><mn>2</mn></msubsup><mo>‚àº</mo><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">G</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ŒΩ</mi><mi>z</mi></msub><mi>/</mi><mn>2</mn><mo>,</mo><msub><mi>ŒΩ</mi><mi>z</mi></msub><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Œæ</mi><mo>‚à£</mo><mi>Œ≤</mi><mo>,</mo><mi>z</mi><mo>,</mo><msubsup><mi>œÉ</mi><mi>Œæ</mi><mn>2</mn></msubsup><mo>,</mo><msub><mi>Œ±</mi><mi>œµ</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mrow><mi mathvariant="normal">G</mi><mi mathvariant="normal">C</mi><msub><mi mathvariant="normal">M</mi><mi mathvariant="normal">c</mi></msub></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Œº</mi><mo accent="true">ÃÉ</mo></mover><mi>Œæ</mi></msub><mo>,</mo><msub><mi>H</mi><mi>Œæ</mi></msub><mo>,</mo><mi>œµ</mi><mo>,</mo><msub><mi>Œ∫</mi><mi>Œæ</mi></msub><mo>;</mo><msub><mi>œà</mi><mi>Œæ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{split}
y(s_i) \mid \beta, z, \xi &amp; \sim \mathrm{EF}\left(x(s_i)^{ \scriptstyle \top }\beta + z(s_i) +
\xi_i - \mu_i; b_i, \psi_y\right), i = 1, \ldots, n\\
\beta \mid \sigma^2_\beta &amp;\sim N(0, \sigma^2_\beta V_\beta), \quad
\sigma^2_\beta \sim \mathrm{IG}(\nu_\beta/2, \nu_\beta/2)\\
z \mid \sigma^2_z &amp;\sim N\left(0, \sigma^2_z R(\chi; {\theta_{\text{sp}}})\right), \quad
\sigma^2_z \sim \mathrm{IG}(\nu_z/2, \nu_z/2),\\
\xi \mid \beta, z, \sigma^2_\xi, \alpha_\epsilon &amp;\sim
\mathrm{GCM_c}\left(\tilde{\mu}_\xi, H_\xi, \epsilon, \kappa_\xi; \psi_\xi\right),
\end{split}
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œº</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mn>1</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>Œº</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup></mrow><annotation encoding="application/x-tex">\mu = (\mu_1, \ldots, \mu_n)^{ \scriptstyle \top }</annotation></semantics></math>
denotes the discrepancy parameter. We fix the spatial process parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><annotation encoding="application/x-tex">{\theta_{\text{sp}}}</annotation></semantics></math>,
the boundary adjustment parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œµ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math>
and the hyperparameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>Œ≤</mi></msub><annotation encoding="application/x-tex">V_\beta</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ŒΩ</mi><mi>Œ≤</mi></msub><annotation encoding="application/x-tex">\nu_\beta</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ŒΩ</mi><mi>z</mi></msub><annotation encoding="application/x-tex">\nu_z</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>œÉ</mi><mi>Œæ</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_\xi</annotation></semantics></math>.
The term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œæ</mi><annotation encoding="application/x-tex">\xi</annotation></semantics></math>
is known as the fine-scale variation term which is given a conditional
generalized conjugate multivariate distribution
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">G</mi><mi mathvariant="normal">C</mi><msub><mi mathvariant="normal">M</mi><mi mathvariant="normal">c</mi></msub></mrow><annotation encoding="application/x-tex">\mathrm{GCM_c}</annotation></semantics></math>)
as prior. For details, see <span class="citation">Pan et al. (<a href="#ref-pan2024stacking">2024</a>)</span>.</p>
</div>
<div class="section level2">
<h2 id="predictive-stacking">Predictive stacking<a class="anchor" aria-label="anchor" href="#predictive-stacking"></a>
</h2>
<p>Following <span class="citation">Yao et al. (<a href="#ref-yao2018stacking">2018</a>)</span>, we consider a set of
candidate models based on a grid of values of the parameters in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo>,</mo><msup><mi>Œ¥</mi><mn>2</mn></msup><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{ {\theta_{\text{sp}}}, \delta^2 \}</annotation></semantics></math>
for the Gaussian case, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>Œ∏</mi><mtext mathvariant="normal">sp</mtext></msub><mo>,</mo><mi>œµ</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{ {\theta_{\text{sp}}}, \epsilon \}</annotation></semantics></math>
for the non-Gaussian case, as will be supplied by the user. We build a
set of candidate models based on the Cartesian product of the collection
of values for each individual parameter as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>‚Ñ≥</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>M</mi><mn>1</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>M</mi><mi>G</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{M} = \{M_1, \ldots, M_G\}</annotation></semantics></math>.
Then, for each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>G</mi></mrow><annotation encoding="application/x-tex">g = 1, \ldots, G</annotation></semantics></math>,
we sample from the posterior distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mo>,</mo><mi>Œ≤</mi><mo>,</mo><mi>z</mi><mo>‚à£</mo><mi>y</mi><mo>,</mo><msub><mi>M</mi><mi>g</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\sigma^2, \beta, z \mid y, M_g)</annotation></semantics></math>
under the model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>g</mi></msub><annotation encoding="application/x-tex">M_g</annotation></semantics></math>
and find leave-one-out predictive densities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>‚à£</mo><msub><mi>y</mi><mrow><mo>‚àí</mo><mi>i</mi></mrow></msub><mo>,</mo><msub><mi>M</mi><mi>g</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(y_i \mid y_{-i}, M_g)</annotation></semantics></math>.
Then we solve the optimization problem
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><munder><mo>max</mo><mrow><msub><mi>w</mi><mn>1</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>w</mi><mi>G</mi></msub></mrow></munder></mtd><mtd columnalign="left" style="text-align: left"><mspace width="0.167em"></mspace><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo>log</mo><munderover><mo>‚àë</mo><mrow><mi>g</mi><mo>=</mo><mn>1</mn></mrow><mi>G</mi></munderover><msub><mi>w</mi><mi>g</mi></msub><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>‚à£</mo><msub><mi>y</mi><mrow><mo>‚àí</mo><mi>i</mi></mrow></msub><mo>,</mo><msub><mi>M</mi><mi>g</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">subject to</mtext></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><msub><mi>w</mi><mi>g</mi></msub><mo>‚â•</mo><mn>0</mn><mo>,</mo><munderover><mo>‚àë</mo><mrow><mi>g</mi><mo>=</mo><mn>1</mn></mrow><mi>G</mi></munderover><msub><mi>w</mi><mi>g</mi></msub><mo>=</mo><mn>1</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
\begin{split}
 \max_{w_1, \ldots, w_G}&amp; \, \frac{1}{n} \sum_{i = 1}^n \log \sum_{g = 1}^G
 w_g p(y_i \mid y_{-i}, M_g) \\
 \text{subject to} &amp; \quad w_g \geq 0, \sum_{g = 1}^G w_g = 1
\end{split}
\end{equation}</annotation></semantics></math> to find the optimal
stacking weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>w</mi><mo accent="true">ÃÇ</mo></mover><mn>1</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mover><mi>w</mi><mo accent="true">ÃÇ</mo></mover><mi>G</mi></msub></mrow><annotation encoding="application/x-tex">\hat{w}_1, \ldots, \hat{w}_G</annotation></semantics></math>.
After obtaining the optimal stacking weights, posterior inference of any
quantity of interest subsequently proceed from the <em>stacked</em>
posterior,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>p</mi><mo accent="true">ÃÉ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo>‚à£</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>g</mi><mo>=</mo><mn>1</mn></mrow><mi>G</mi></munderover><msub><mover><mi>w</mi><mo accent="true">ÃÇ</mo></mover><mi>g</mi></msub><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo>‚à£</mo><mi>y</mi><mo>,</mo><msub><mi>M</mi><mi>g</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
\tilde{p}(\cdot \mid y) = \sum_{g = 1}^G \hat{w}_g p(\cdot \mid y, M_g).
\end{equation}</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="illustrations">Illustrations<a class="anchor" aria-label="anchor" href="#illustrations"></a>
</h2>
<p>In this section, we thoroughly illustrate our method on synthetic
Gaussian as well as non-Gaussian spatial data and provide code to
analyze the output of our functions. We start by loading the
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://span-18.github.io/spStack-dev/">spStack</a></span><span class="op">)</span></span></code></pre></div>
<p>Some synthetic spatial data are lazy-loaded which includes synthetic
spatial Gaussian data <code>simGaussian</code>, Poisson data
<code>simPoisson</code>, binomial data <code>simBinom</code> and binary
data <code>simBinary</code>. One can use the function
<code><a href="../reference/sim_spData.html">sim_spData()</a></code> to simulate spatial data. We will be applying
our functions on these datasets.</p>
<div class="section level3">
<h3 id="analysis-of-spatial-gaussian-data">Analysis of spatial Gaussian data<a class="anchor" aria-label="anchor" href="#analysis-of-spatial-gaussian-data"></a>
</h3>
<p>We first load the data <code>simGaussian</code> and set up the
priors. Supplying the priors is optional. See the documentation of
<code><a href="../reference/spLMexact.html">spLMexact()</a></code> to learn more about the default priors.
Besides, setting the priors, we also fix the values of the spatial
process parameters and the noise-to-spatial variance ratio.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"simGaussian"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">simGaussian</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span> <span class="co"># work with first 200 rows</span></span>
<span></span>
<span><span class="va">muBeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">VBeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10.0</span>, <span class="fl">0.0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">10.0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sigmaSqIGa</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">sigmaSqIGb</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">phi0</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">nu0</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">noise_sp_ratio</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="va">prior_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta.norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">muBeta</span>, <span class="va">VBeta</span><span class="op">)</span>,</span>
<span>                   sigma.sq.ig <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigmaSqIGa</span>, <span class="va">sigmaSqIGb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nSamples</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span></code></pre></div>
<p>We then pass these parameters into the main function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1729</span><span class="op">)</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spLMexact.html">spLMexact</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>                  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                  cor.fn <span class="op">=</span> <span class="st">"matern"</span>,</span>
<span>                  priors <span class="op">=</span> <span class="va">prior_list</span>,</span>
<span>                  spParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="va">phi0</span>, nu <span class="op">=</span> <span class="va">nu0</span><span class="op">)</span>,</span>
<span>                  noise_sp_ratio <span class="op">=</span> <span class="va">noise_sp_ratio</span>, n.samples <span class="op">=</span> <span class="va">nSamples</span>,</span>
<span>                  loopd <span class="op">=</span> <span class="cn">TRUE</span>, loopd.method <span class="op">=</span> <span class="st">"exact"</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;  Model description</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; Model fit with 200 observations.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of covariates 2 (including intercept).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Using the matern spatial correlation function.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Priors:</span></span>
<span><span class="co">#&gt;  beta: Gaussian</span></span>
<span><span class="co">#&gt;  mu: 0.00    0.00    </span></span>
<span><span class="co">#&gt;  cov:</span></span>
<span><span class="co">#&gt;  10.00   0.00    </span></span>
<span><span class="co">#&gt;  0.00    10.00   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sigma.sq: Inverse-Gamma</span></span>
<span><span class="co">#&gt;  shape = 2.00, scale = 2.00.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Spatial process parameters:</span></span>
<span><span class="co">#&gt;  phi = 2.00, and, nu = 0.50.</span></span>
<span><span class="co">#&gt; Noise-to-spatial variance ratio = 0.80.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of posterior samples = 2000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; LOO-PD calculation method = exact.</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span></code></pre></div>
<p>Next, we can summarize the posterior samples of the fixed effects as
follows.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_beta</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">summary_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_beta</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">X.names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 2.5%      50%    97.5%</span></span>
<span><span class="co">#&gt; (Intercept) 1.388249 2.129140 2.932428</span></span>
<span><span class="co">#&gt; x1          4.865843 4.954446 5.045627</span></span></code></pre></div>
<p>If interested in finding leave-one-out predictive densities (LOO-PD)
for this model, set <code>loopd</code> to <code>TRUE</code> and provide
a <code>loopd.method</code>. Valid inputs for <code>loopd.method</code>
are <code>"exact"</code> and <code>"PSIS"</code> which finds exact
LOO-PD using closed form expressions and approximate LOO-PD using Pareto
smoothed importance sampling <span class="citation">(<a href="#ref-LOOCV_vehtari17">Vehtari, Gelman, and Gabry
2017</a>)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spLMexact.html">spLMexact</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>                  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                  cor.fn <span class="op">=</span> <span class="st">"matern"</span>,</span>
<span>                  priors <span class="op">=</span> <span class="va">prior_list</span>,</span>
<span>                  spParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="va">phi0</span>, nu <span class="op">=</span> <span class="va">nu0</span><span class="op">)</span>,</span>
<span>                  noise_sp_ratio <span class="op">=</span> <span class="va">noise_sp_ratio</span>, n.samples <span class="op">=</span> <span class="va">nSamples</span>,</span>
<span>                  loopd <span class="op">=</span> <span class="cn">TRUE</span>, loopd.method <span class="op">=</span> <span class="st">"PSIS"</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Out of curiosity, we compare the LOO-PD obtained by the two
methods.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loopd_exact</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">loopd</span></span>
<span><span class="va">loopd_psis</span> <span class="op">&lt;-</span> <span class="va">mod2</span><span class="op">$</span><span class="va">loopd</span></span>
<span><span class="va">loopd_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>exact <span class="op">=</span> <span class="va">loopd_exact</span>, psis <span class="op">=</span> <span class="va">loopd_psis</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">loopd_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">exact</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">psis</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Exact"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"PSIS"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">plot1</span></span></code></pre></div>
<p><img src="spStack_files/figure-html/unnamed-chunk-4-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Next, we move on to the Bayesian spatial stacking algorithm for
Gaussian data. We supply the same prior list and provide some candidate
values of spatial process parameters and noise-to-spatial variance
ratio.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spLMstack.html">spLMstack</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>                  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                  cor.fn <span class="op">=</span> <span class="st">"matern"</span>,</span>
<span>                  priors <span class="op">=</span> <span class="va">prior_list</span>,</span>
<span>                  params.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                                     nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                                     noise_sp_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  n.samples <span class="op">=</span> <span class="fl">1000</span>, loopd.method <span class="op">=</span> <span class="st">"exact"</span>,</span>
<span>                  parallel <span class="op">=</span> <span class="cn">FALSE</span>, solver <span class="op">=</span> <span class="st">"ECOS"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; STACKING WEIGHTS:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            | phi | nu  | noise_sp_ratio | weight |</span></span>
<span><span class="co">#&gt; +----------+-----+-----+----------------+--------+</span></span>
<span><span class="co">#&gt; | Model 1  |  1.5|  0.5|             0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 2  |  3.0|  0.5|             0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 3  |  5.0|  0.5|             0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 4  |  1.5|  1.0|             0.5| 0.226  |</span></span>
<span><span class="co">#&gt; | Model 5  |  3.0|  1.0|             0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 6  |  5.0|  1.0|             0.5| 0.774  |</span></span>
<span><span class="co">#&gt; | Model 7  |  1.5|  1.5|             0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 8  |  3.0|  1.5|             0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 9  |  5.0|  1.5|             0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 10 |  1.5|  0.5|             1.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 11 |  3.0|  0.5|             1.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 12 |  5.0|  0.5|             1.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 13 |  1.5|  1.0|             1.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 14 |  3.0|  1.0|             1.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 15 |  5.0|  1.0|             1.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 16 |  1.5|  1.5|             1.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 17 |  3.0|  1.5|             1.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 18 |  5.0|  1.5|             1.5| 0.000  |</span></span>
<span><span class="co">#&gt; +----------+-----+-----+----------------+--------+</span></span></code></pre></div>
<p>The user can check the solver status and runtime by issuing the
following.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">$</span><span class="va">solver.status</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "optimal"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">$</span><span class="va">run.time</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   2.463   3.147   1.674</span></span></code></pre></div>
<p>To sample from the stacked posterior, the package provides a helper
function called <code><a href="../reference/stackedSampler.html">stackedSampler()</a></code>. Subsequent inference
proceeds from these samples obtained from the stacked posterior.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_samps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stackedSampler.html">stackedSampler</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span></code></pre></div>
<p>We then collect the samples of the fixed effects and summarize them
as follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_beta</span> <span class="op">&lt;-</span> <span class="va">post_samps</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">summary_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_beta</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mod3</span><span class="op">$</span><span class="va">X.names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  2.5%      50%    97.5%</span></span>
<span><span class="co">#&gt; (Intercept) 0.9303819 2.185930 2.949784</span></span>
<span><span class="co">#&gt; x1          4.8678581 4.954272 5.030520</span></span></code></pre></div>
<p>Here, we compare the posterior samples of the spatial random effects
with their corresponding true values.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_z</span> <span class="op">&lt;-</span> <span class="va">post_samps</span><span class="op">$</span><span class="va">z</span></span>
<span><span class="va">post_z_summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_z</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">z_combn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">z_true</span>, zL <span class="op">=</span> <span class="va">post_z_summ</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>                      zM <span class="op">=</span> <span class="va">post_z_summ</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, zU <span class="op">=</span> <span class="va">post_z_summ</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plotz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">z_combn</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">zM</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.75</span>, color <span class="op">=</span> <span class="st">"darkblue"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">zL</span>, ymax <span class="op">=</span> <span class="va">zU</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.15</span>, </span>
<span>                color <span class="op">=</span> <span class="st">"skyblue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"True z"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Stacked posterior of z"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">plotz</span></span></code></pre></div>
<p><img src="spStack_files/figure-html/unnamed-chunk-8-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The package also provides functions to plot interpolated spatial
surfaces in order for visualization purposes. The function
<code><a href="../reference/surfaceplot.html">surfaceplot()</a></code> creates a single spatial surface plot, while
<code><a href="../reference/surfaceplot2.html">surfaceplot2()</a></code> creates two side-by-side surface plots. We
are using the later to visually inspect the interpolated spatial
surfaces of the true spatial effects and their posterior medians.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postmedian_z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_z</span>, <span class="fl">1</span>, <span class="va">median</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">z_hat</span> <span class="op">&lt;-</span> <span class="va">postmedian_z</span></span>
<span><span class="va">plot_z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/surfaceplot2.html">surfaceplot2</a></span><span class="op">(</span><span class="va">dat</span>, coords_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span>,</span>
<span>                       var1_name <span class="op">=</span> <span class="st">"z_true"</span>, var2_name <span class="op">=</span> <span class="st">"z_hat"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plot_z</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spStack_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="analysis-of-spatial-non-gaussian-data">Analysis of spatial non-Gaussian data<a class="anchor" aria-label="anchor" href="#analysis-of-spatial-non-gaussian-data"></a>
</h3>
<p>In this package, we offer functions for Bayesian analysis Poisson and
binomial count data as well as binary data.</p>
<div class="section level4">
<h4 id="spatial-poisson-count-data">Spatial Poisson count data<a class="anchor" aria-label="anchor" href="#spatial-poisson-count-data"></a>
</h4>
<p>We first load and plot the point-referenced Poisson count data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"simPoisson"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">simPoisson</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span> <span class="co"># work with first 200 observations</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">s1</span>, y <span class="op">=</span> <span class="va">s2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"RdYlGn"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, </span>
<span>                        label <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.0f"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, hjust <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>        legend.box.just <span class="op">=</span> <span class="st">"center"</span>, aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="spStack_files/figure-html/unnamed-chunk-10-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Next, we demonstrate the function <code><a href="../reference/spGLMexact.html">spGLMexact()</a></code> which
delivers posterior samples of the fixed effects and the spatial random
effects. The option <code>family</code> must be specified correctly
while using this function. For instance, in this example
<code>family = "poisson"</code>. We provide fixed values of the spatial
process parameters and the boundary adjustment parameter, given by the
argument <code>boundary</code>, which if not supplied, defaults to 0.5.
For details on the priors and its default value, see function
documentation.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spGLMexact.html">spGLMexact</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>                   coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, cor.fn <span class="op">=</span> <span class="st">"matern"</span>,</span>
<span>                   spParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="va">phi0</span>, nu <span class="op">=</span> <span class="va">nu0</span><span class="op">)</span>,</span>
<span>                   boundary <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                   n.samples <span class="op">=</span> <span class="fl">1000</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;  Model description</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; Model fit with 200 observations.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family = poisson.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of covariates 2 (including intercept).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Using the matern spatial correlation function.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Priors:</span></span>
<span><span class="co">#&gt;  beta: Gaussian</span></span>
<span><span class="co">#&gt;  mu: 0.00    0.00    </span></span>
<span><span class="co">#&gt;  cov:</span></span>
<span><span class="co">#&gt;  100.00  0.00    </span></span>
<span><span class="co">#&gt;  0.00    100.00  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sigmaSq.beta ~ IG(nu.beta/2, nu.beta/2)</span></span>
<span><span class="co">#&gt;  sigmaSq.z ~ IG(nu.z/2, nu.z/2)</span></span>
<span><span class="co">#&gt;  nu.beta = 2.10, nu.z = 2.10.</span></span>
<span><span class="co">#&gt;  sigmaSq.xi = 0.10.</span></span>
<span><span class="co">#&gt;  Boundary adjustment parameter = 0.50.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Spatial process parameters:</span></span>
<span><span class="co">#&gt;  phi = 2.00, and, nu = 0.50.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of posterior samples = 1000.</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span></code></pre></div>
<p>We next collect the samples of the fixed effects and summarize them.
The true value of the fixed effects with which the data was simulated is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ≤</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>,</mo><mo>‚àí</mo><mn>0.5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\beta = (2, -0.5)</annotation></semantics></math>
(for more details, see the documentation of the data
<code>simPoisson</code>).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_beta</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">summary_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_beta</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">X.names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   2.5%        50%      97.5%</span></span>
<span><span class="co">#&gt; (Intercept) -0.1302807  1.9026041  4.3045317</span></span>
<span><span class="co">#&gt; x1          -0.6664152 -0.5545303 -0.4543145</span></span></code></pre></div>
<p>Next, we move on to the function <code><a href="../reference/spGLMstack.html">spGLMstack()</a></code> that will
implement our proposed stacking algorithm. The argument
<code>loopd.controls</code> is used to provide details on what algorithm
to be used to find LOO-PD. Valid options for the tag <code>method</code>
is <code>"exact"</code> and <code>"CV"</code>. We use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>-fold
cross-validation by assigning <code>method = "CV"</code>and
<code>CV.K = 10</code>. The tag <code>nMC</code> decides the number of
Monte Carlo samples to be used to find the LOO-PD.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spGLMstack.html">spGLMstack</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>                   coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, cor.fn <span class="op">=</span> <span class="st">"matern"</span>,</span>
<span>                   params.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span>, nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                                      boundary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   n.samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                   loopd.controls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"CV"</span>, CV.K <span class="op">=</span> <span class="fl">10</span>, nMC <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,</span>
<span>                   parallel <span class="op">=</span> <span class="cn">TRUE</span>, solver <span class="op">=</span> <span class="st">"ECOS"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; STACKING WEIGHTS:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            | phi | nu  | boundary | weight |</span></span>
<span><span class="co">#&gt; +----------+-----+-----+----------+--------+</span></span>
<span><span class="co">#&gt; | Model 1  |    3|  0.5|       0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 2  |    7|  0.5|       0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 3  |   10|  0.5|       0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 4  |    3|  1.5|       0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 5  |    7|  1.5|       0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 6  |   10|  1.5|       0.5| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 7  |    3|  0.5|       0.6| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 8  |    7|  0.5|       0.6| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 9  |   10|  0.5|       0.6| 0.000  |</span></span>
<span><span class="co">#&gt; | Model 10 |    3|  1.5|       0.6| 0.175  |</span></span>
<span><span class="co">#&gt; | Model 11 |    7|  1.5|       0.6| 0.825  |</span></span>
<span><span class="co">#&gt; | Model 12 |   10|  1.5|       0.6| 0.000  |</span></span>
<span><span class="co">#&gt; +----------+-----+-----+----------+--------+</span></span></code></pre></div>
<p>We can extract information on solver status and runtime by the
following.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">$</span><span class="va">solver.status</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "optimal"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">$</span><span class="va">run.time</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  24.320  34.959  15.036</span></span></code></pre></div>
<p>We first obtain final posterior samples by sampling from the stacked
sampler.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_samps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stackedSampler.html">stackedSampler</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span></code></pre></div>
<p>Subsequently, we summarize the posterior samples of the fixed
effects.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_beta</span> <span class="op">&lt;-</span> <span class="va">post_samps</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">summary_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_beta</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mod3</span><span class="op">$</span><span class="va">X.names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   2.5%        50%      97.5%</span></span>
<span><span class="co">#&gt; (Intercept) -0.8032363  2.0460414  3.8253354</span></span>
<span><span class="co">#&gt; x1          -0.6275769 -0.5471968 -0.4529202</span></span></code></pre></div>
<p>Finally, we analyze the posterior samples of the spatial random
effects.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_z</span> <span class="op">&lt;-</span> <span class="va">post_samps</span><span class="op">$</span><span class="va">z</span></span>
<span><span class="va">post_z_summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_z</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">z_combn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">z_true</span>, zL <span class="op">=</span> <span class="va">post_z_summ</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>                      zM <span class="op">=</span> <span class="va">post_z_summ</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, zU <span class="op">=</span> <span class="va">post_z_summ</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plotz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">z_combn</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">zM</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.75</span>, color <span class="op">=</span> <span class="st">"darkblue"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">zL</span>, ymax <span class="op">=</span> <span class="va">zU</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"skyblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"True z"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Stacked posterior of z"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">plotz</span></span></code></pre></div>
<p><img src="spStack_files/figure-html/unnamed-chunk-15-1.png" width="700" style="display: block; margin: auto;"></p>
<p>We can also compare the interpolated spatial surfaces of the true
spatial effects with that of their posterior median.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postmedian_z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_z</span>, <span class="fl">1</span>, <span class="va">median</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">z_hat</span> <span class="op">&lt;-</span> <span class="va">postmedian_z</span></span>
<span><span class="va">plot_z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/surfaceplot2.html">surfaceplot2</a></span><span class="op">(</span><span class="va">dat</span>, coords_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span>,</span>
<span>                       var1_name <span class="op">=</span> <span class="st">"z_true"</span>, var2_name <span class="op">=</span> <span class="st">"z_hat"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plot_z</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spStack_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="spatial-binomial-count-data">Spatial binomial count data<a class="anchor" aria-label="anchor" href="#spatial-binomial-count-data"></a>
</h4>
<p>Here, we present only the <code><a href="../reference/spGLMexact.html">spGLMexact()</a></code> function for
brevity. The only argument that will change from that of in the case of
spatial Poisson data is the structure of <code>formula</code> that
defines the model.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"simBinom"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">simBinom</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span> <span class="co"># work with first 200 rows</span></span>
<span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spGLMexact.html">spGLMexact</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">n_trials</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                   coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, cor.fn <span class="op">=</span> <span class="st">"matern"</span>,</span>
<span>                   spParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="fl">3</span>, nu <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                   boundary <span class="op">=</span> <span class="fl">0.5</span>, n.samples <span class="op">=</span> <span class="fl">1000</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, we collect the posterior samples of the fixed effects and
summarize them. The true value of the fixed effects with which the data
was simulated is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ≤</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.5</mn><mo>,</mo><mo>‚àí</mo><mn>0.5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\beta = (0.5, -0.5)</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_beta</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">summary_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_beta</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">X.names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   2.5%        50%      97.5%</span></span>
<span><span class="co">#&gt; (Intercept) -1.2039026  0.7229478  2.5872269</span></span>
<span><span class="co">#&gt; x1          -0.5815266 -0.4016808 -0.2365151</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="spatial-binary-data">Spatial binary data<a class="anchor" aria-label="anchor" href="#spatial-binary-data"></a>
</h4>
<p>Finally, we present only the <code><a href="../reference/spGLMexact.html">spGLMexact()</a></code> function for
spatial binary data to avoid repetition. In this case, unlike the
binomial model, almost nothing changes from that of in the case of
spatial Poisson data.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"simBinary"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">simBinary</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spGLMexact.html">spGLMexact</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>                   coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, cor.fn <span class="op">=</span> <span class="st">"matern"</span>,</span>
<span>                   spParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="fl">4</span>, nu <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                   boundary <span class="op">=</span> <span class="fl">0.5</span>, n.samples <span class="op">=</span> <span class="fl">1000</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, we collect the posterior samples of the fixed effects and
summarize them. The true value of the fixed effects with which the data
was simulated is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ≤</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.5</mn><mo>,</mo><mo>‚àí</mo><mn>0.5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\beta = (0.5, -0.5)</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_beta</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">summary_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_beta</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">X.names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_beta</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   2.5%        50%      97.5%</span></span>
<span><span class="co">#&gt; (Intercept) -1.1291296  0.3061828 1.70795510</span></span>
<span><span class="co">#&gt; x1          -0.6507851 -0.3088350 0.04471555</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>We have devised and demonstrated Bayesian predictive stacking to be
an effective tool for estimating spatial regression models and yielding
robust predictions for Gaussian as well as non-Gaussian spatial data. We
develop and exploit analytically accessible distribution theory
pertaining to Bayesian analysis of linear mixed model and generalized
linear mixed models that enables us to directly sample from the
posterior distributions. The focus of this package is on effectively
combining inference across different closed-form posterior distributions
by circumventing inference on weakly identified parameters. Future
developments and investigations will consider zero-inflated non-Gaussian
data and adapting to variants of Gaussian process models that scale
inference to massive datasets by circumventing the Cholesky
decomposition of dense covariance matrices.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-banerjee_massivespatial" class="csl-entry">
Banerjee, Sudipto. 2020. <span>‚ÄúModeling Massive Spatial Datasets Using
a Conjugate <span>B</span>ayesian Linear Modeling Framework.‚Äù</span>
<em>Spatial Statistics</em> 37: 100417. <a href="https://doi.org/10.1016/j.spasta.2020.100417" class="external-link">https://doi.org/10.1016/j.spasta.2020.100417</a>.
</div>
<div id="ref-bradleyclinch2024" class="csl-entry">
Bradley, Jonathan R., and Madelyn Clinch. 2024. <span>‚ÄúGenerating
Independent Replicates Directly from the Posterior Distribution for a
Class of Spatial Hierarchical Models.‚Äù</span> <em>Journal of
Computational and Graphical Statistics</em> 0 (0): 1‚Äì17. <a href="https://doi.org/10.1080/10618600.2024.2365728" class="external-link">https://doi.org/10.1080/10618600.2024.2365728</a>.
</div>
<div id="ref-pan2024stacking" class="csl-entry">
Pan, Soumyakanti, Lu Zhang, Jonathan R. Bradley, and Sudipto Banerjee.
2024. <span>‚ÄúBayesian Inference for Spatial-Temporal Non-Gaussian Data
Using Predictive Stacking.‚Äù</span> <a href="https://arxiv.org/abs/2406.04655" class="external-link">https://arxiv.org/abs/2406.04655</a>.
</div>
<div id="ref-LOOCV_vehtari17" class="csl-entry">
Vehtari, Aki, Andrew Gelman, and Jonah Gabry. 2017. <span>‚ÄúPractical
<span>B</span>ayesian Model Evaluation Using Leave-One-Out
Cross-Validation and WAIC.‚Äù</span> <em>Statistics and Computing</em> 27
(5): 1413‚Äì32. <a href="https://doi.org/10.1007/s11222-016-9696-4" class="external-link">https://doi.org/10.1007/s11222-016-9696-4</a>.
</div>
<div id="ref-yao2018stacking" class="csl-entry">
Yao, Yuling, Aki Vehtari, Daniel Simpson, and Andrew Gelman. 2018.
<span>‚Äú<span class="nocase">Using Stacking to Average
<span>B</span>ayesian Predictive Distributions (with
Discussion)</span>.‚Äù</span> <em>Bayesian Analysis</em> 13 (3): 917‚Äì1007.
<a href="https://doi.org/10.1214/17-BA1091" class="external-link">https://doi.org/10.1214/17-BA1091</a>.
</div>
<div id="ref-zhang2024stacking" class="csl-entry">
Zhang, Lu, Wenpin Tang, and Sudipto Banerjee. 2024. <span>‚ÄúBayesian
Geostatistics Using Predictive Stacking.‚Äù</span> <a href="https://arxiv.org/abs/2304.12414" class="external-link">https://arxiv.org/abs/2304.12414</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Soumyakanti Pan, Sudipto Banerjee.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
